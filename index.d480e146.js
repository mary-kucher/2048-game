!function(){function t(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}function e(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function i(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}var s,n=function(){function e(i,s){t(this,e),this.value=.9>Math.random()?2:4,this.tileHTML=document.createElement("div"),this.position={row:i,cell:s,indexArr:4*i+s}}return i(e,[{key:"setNewPosition",value:function(t,e){this.position={row:t,cell:e,indexArr:4*t+e}}},{key:"merge",value:function(t){this.value+=t.value,t.setNewPosition(this.position.row,this.position.cell),this.tileHTML.style.zIndex="2",t.tileHTML.style.zIndex="1",t.render(),setTimeout(function(){return t.tileHTML.remove()},300)}},{key:"render",value:function(){var t=document.querySelectorAll(".field-cell");this.tileHTML.textContent="".concat(this.value),this.tileHTML.className="tile tile--".concat(this.value);var e=t[this.position.indexArr].getBoundingClientRect(),i=e.top,s=e.left;this.tileHTML.style.top="".concat(i,"px"),this.tileHTML.style.left="".concat(s,"px")}},{key:"addTileToView",value:function(){document.querySelector(".tile-container").append(this.tileHTML)}}]),e}(),r=function(){function e(){t(this,e),this.matrix=[[null,null,null,null],[null,null,null,null],[null,null,null,null],[null,null,null,null]],this.wasMove=!1,this.maxTileValue=2048,this.wasMerge=!1,this.mergedTilesSum=0,this.win=!1,this.addTile(),this.addTile(),this.updated()}return i(e,[{key:"coordsEmptyTiles",value:function(){return this.matrix.map(function(t,e){return t.map(function(t,i){if(null==t)return{x:e,y:i}})}).flat().filter(function(t){return t})}},{key:"addTile",value:function(){var t=this.coordsEmptyTiles(),e=Math.floor(Math.random()*t.length),i=t[e],s=i.x,r=i.y;this.matrix[s][r]=new n(s,r),this.matrix[s][r].addTileToView()}},{key:"updated",value:function(){for(var t=0;t<this.matrix.length;t++)for(var e=0;e<this.matrix.length;e++)this.matrix[t][e]&&(this.matrix[t][e].setNewPosition(t,e),this.matrix[t][e].render())}},{key:"clear",value:function(){this.matrix.flat().filter(function(t){return t}).forEach(function(t){t.tileHTML.remove()})}},{key:"moveLeft",value:function(){this.cleanMoveMerge(),this.shift(!1)}},{key:"moveRight",value:function(){this.cleanMoveMerge(),this.shift()}},{key:"moveUp",value:function(){this.cleanMoveMerge(),this.shiftUpDown(!1)}},{key:"moveDown",value:function(){this.cleanMoveMerge(),this.shiftUpDown()}},{key:"swapTiles",value:function(t,e,i,s){var n=this.matrix[t][e];this.matrix[t][e]=this.matrix[i][s],this.matrix[i][s]=n,this.wasMove=!0}},{key:"shift",value:function(){for(var t=!(arguments.length>0)||void 0===arguments[0]||arguments[0],e=0;e<this.matrix.length;e++)for(var i=t?this.matrix.length-1:0,s=t?i-1:1,n=t?-1:1;s<this.matrix.length&&s>=0;)this.matrix[e][s]?this.matrix[e][i]?this.matrix[e][i].value===this.matrix[e][s].value?(this.matrix[e][i].setNewPosition(e,i),this.mergeTiles(e,s,e,i),i+=n,s+=n):(i+=n)===s&&(s+=n):(this.swapTiles(e,i,e,s),s+=n):s+=n}},{key:"shiftUpDown",value:function(){for(var t=!(arguments.length>0)||void 0===arguments[0]||arguments[0],e=0;e<this.matrix.length;e++)for(var i=t?this.matrix.length-1:0,s=t?i-1:1,n=t?-1:1;s<this.matrix.length&&s>=0;)this.matrix[s][e]?this.matrix[i][e]?this.matrix[i][e].value===this.matrix[s][e].value?(this.matrix[i][e].setNewPosition(i,e),this.mergeTiles(s,e,i,e),i+=n,s+=n):(i+=n)===s&&(s+=n):(this.swapTiles(i,e,s,e),s+=n):s+=n}},{key:"mergeTiles",value:function(t,e,i,s){this.wasMerge=!0;var n=this.matrix[t][e].value;this.mergedTilesSum+=2*n,this.matrix[i][s].merge(this.matrix[t][e]),this.matrix[t][e]=null,this.matrix[i][s].value===this.maxTileValue&&(this.win=!0)}},{key:"cleanMoveMerge",value:function(){this.wasMove=!1,this.wasMerge=!1}},{key:"isMergePossible",value:function(){return this.matrix.flat().some(function(t,e,i){var s=t.value;return(e+1)%4!=0&&s===i[e+1].value||e+4<=i.length-1&&s===i[e+4].value})}}]),e}(),a=function(){function e(){t(this,e),this.score=0,this.table=new r,this.listenerArrows=this.handleArrowsButtonPressing.bind(this),this.touchStartListener=this.handleTouchStart.bind(this),this.touchEndListener=this.handleTouchEnd.bind(this),this.gameField=document.querySelector(".game-field"),this.endGame=document.querySelector(".message-lose"),this.addScore=document.querySelector(".game-score"),this.winGame=document.querySelector(".message-win"),this.arrows=["ArrowLeft","ArrowUp","ArrowRight","ArrowDown"],document.addEventListener("keydown",this.listenerArrows),this.x1=null,this.y1=null,this.gameField.addEventListener("touchstart",this.touchStartListener),this.gameField.addEventListener("touchmove",this.touchEndListener)}return i(e,[{key:"handleTouchStart",value:function(t){t.preventDefault();var e=t.touches[0];this.x1=e.clientX,this.y1=e.clientY}},{key:"handleTouchEnd",value:function(t){if(t.preventDefault(),!this.x1||!this.y1)return!1;var e=t.touches[0].clientX,i=t.touches[0].clientY,s=e-this.x1,n=i-this.y1;Math.abs(s)>Math.abs(n)?s>0?this.table.moveRight():this.table.moveLeft():n>0?this.table.moveDown():this.table.moveUp(),this.x1=null,this.y1=null,this.allChecks()}},{key:"handleArrowsButtonPressing",value:function(t){if(this.arrows.includes(t.key)){switch(t.preventDefault(),t.key){case"ArrowLeft":this.table.moveLeft();break;case"ArrowUp":this.table.moveUp();break;case"ArrowRight":this.table.moveRight();break;case"ArrowDown":this.table.moveDown()}this.allChecks()}}},{key:"allChecks",value:function(){var t=this;(this.table.wasMove||this.table.wasMerge)&&this.table.addTile(),this.table.updated(),this.table.wasMerge&&(this.score+=this.table.mergedTilesSum,this.table.mergedTilesSum=0),this.addScore.textContent=this.score,this.table.coordsEmptyTiles().length<1&&!this.table.isMergePossible()?setTimeout(function(){return t.endGame.classList.remove("hidden")},1e3):this.table.win&&this.winGame.classList.remove("hidden")}},{key:"stop",value:function(){document.removeEventListener("keydown",this.listenerArrows),this.gameField.removeEventListener("touchstart",this.touchStartListener),this.gameField.removeEventListener("touchmove",this.touchEndListener),this.table.clear(),this.endGame.classList.add("hidden"),this.winGame.classList.add("hidden"),this.score=0,this.addScore.textContent="0"}}]),e}(),l=document.querySelector("button");l.addEventListener("click",function(t){var e=document.querySelector(".message-start");s&&s.stop(),e.classList.add("hidden"),s=new a,l.classList.remove("start"),l.classList.add("restart"),l.textContent="Restart"})}();
//# sourceMappingURL=index.d480e146.js.map
