let t;class e{setNewPosition(t,e){this.position={row:t,cell:e,indexArr:4*t+e}}merge(t){this.value+=t.value,t.setNewPosition(this.position.row,this.position.cell),this.tileHTML.style.zIndex="2",t.tileHTML.style.zIndex="1",t.render(),setTimeout(()=>t.tileHTML.remove(),300)}render(){let t=document.querySelectorAll(".field-cell");this.tileHTML.textContent=`${this.value}`,this.tileHTML.className=`tile tile--${this.value}`;let{top:e,left:i}=t[this.position.indexArr].getBoundingClientRect();this.tileHTML.style.top=`${e}px`,this.tileHTML.style.left=`${i}px`}addTileToView(){document.querySelector(".tile-container").append(this.tileHTML)}constructor(t,e){this.value=.9>Math.random()?2:4,this.tileHTML=document.createElement("div"),this.position={row:t,cell:e,indexArr:4*t+e}}}class i{coordsEmptyTiles(){return this.matrix.map((t,e)=>t.map((t,i)=>{if(null==t)return{x:e,y:i}})).flat().filter(t=>t)}addTile(){let t=this.coordsEmptyTiles(),i=Math.floor(Math.random()*t.length),{x:s,y:l}=t[i];this.matrix[s][l]=new e(s,l),this.matrix[s][l].addTileToView()}updated(){for(let t=0;t<this.matrix.length;t++)for(let e=0;e<this.matrix.length;e++)this.matrix[t][e]&&(this.matrix[t][e].setNewPosition(t,e),this.matrix[t][e].render())}clear(){this.matrix.flat().filter(t=>t).forEach(t=>{t.tileHTML.remove()})}moveLeft(){this.cleanMoveMerge(),this.shift(!1)}moveRight(){this.cleanMoveMerge(),this.shift()}moveUp(){this.cleanMoveMerge(),this.shiftUpDown(!1)}moveDown(){this.cleanMoveMerge(),this.shiftUpDown()}swapTiles(t,e,i,s){let l=this.matrix[t][e];this.matrix[t][e]=this.matrix[i][s],this.matrix[i][s]=l,this.wasMove=!0}shift(t=!0){for(let e=0;e<this.matrix.length;e++){let i=t?this.matrix.length-1:0,s=t?i-1:1,l=t?-1:1;for(;s<this.matrix.length&&s>=0;)this.matrix[e][s]?this.matrix[e][i]?this.matrix[e][i].value===this.matrix[e][s].value?(this.matrix[e][i].setNewPosition(e,i),this.mergeTiles(e,s,e,i),i+=l,s+=l):(i+=l)===s&&(s+=l):(this.swapTiles(e,i,e,s),s+=l):s+=l}}shiftUpDown(t=!0){for(let e=0;e<this.matrix.length;e++){let i=t?this.matrix.length-1:0,s=t?i-1:1,l=t?-1:1;for(;s<this.matrix.length&&s>=0;)this.matrix[s][e]?this.matrix[i][e]?this.matrix[i][e].value===this.matrix[s][e].value?(this.matrix[i][e].setNewPosition(i,e),this.mergeTiles(s,e,i,e),i+=l,s+=l):(i+=l)===s&&(s+=l):(this.swapTiles(i,e,s,e),s+=l):s+=l}}mergeTiles(t,e,i,s){this.wasMerge=!0;let l=this.matrix[t][e].value;this.mergedTilesSum+=2*l,this.matrix[i][s].merge(this.matrix[t][e]),this.matrix[t][e]=null,this.matrix[i][s].value===this.maxTileValue&&(this.win=!0)}cleanMoveMerge(){this.wasMove=!1,this.wasMerge=!1}isMergePossible(){return this.matrix.flat().some((t,e,i)=>{let s=t.value;return(e+1)%4!=0&&s===i[e+1].value||e+4<=i.length-1&&s===i[e+4].value})}constructor(){this.matrix=[[null,null,null,null],[null,null,null,null],[null,null,null,null],[null,null,null,null]],this.wasMove=!1,this.maxTileValue=2048,this.wasMerge=!1,this.mergedTilesSum=0,this.win=!1,this.addTile(),this.addTile(),this.updated()}}class s{handleTouchStart(t){t.preventDefault();let e=t.touches[0];this.x1=e.clientX,this.y1=e.clientY}handleTouchEnd(t){if(t.preventDefault(),!this.x1||!this.y1)return!1;let e=t.touches[0].clientX,i=t.touches[0].clientY,s=e-this.x1,l=i-this.y1;Math.abs(s)>Math.abs(l)?s>0?this.table.moveRight():this.table.moveLeft():l>0?this.table.moveDown():this.table.moveUp(),this.x1=null,this.y1=null,this.allChecks()}handleArrowsButtonPressing(t){if(this.arrows.includes(t.key)){switch(t.preventDefault(),t.key){case"ArrowLeft":this.table.moveLeft();break;case"ArrowUp":this.table.moveUp();break;case"ArrowRight":this.table.moveRight();break;case"ArrowDown":this.table.moveDown()}this.allChecks()}}allChecks(){(this.table.wasMove||this.table.wasMerge)&&this.table.addTile(),this.table.updated(),this.table.wasMerge&&(this.score+=this.table.mergedTilesSum,this.table.mergedTilesSum=0),this.addScore.textContent=this.score,this.table.coordsEmptyTiles().length<1&&!this.table.isMergePossible()?setTimeout(()=>this.endGame.classList.remove("hidden"),1e3):this.table.win&&this.winGame.classList.remove("hidden")}stop(){document.removeEventListener("keydown",this.listenerArrows),this.gameField.removeEventListener("touchstart",this.touchStartListener),this.gameField.removeEventListener("touchmove",this.touchEndListener),this.table.clear(),this.endGame.classList.add("hidden"),this.winGame.classList.add("hidden"),this.score=0,this.addScore.textContent="0"}constructor(){this.score=0,this.table=new i,this.listenerArrows=this.handleArrowsButtonPressing.bind(this),this.touchStartListener=this.handleTouchStart.bind(this),this.touchEndListener=this.handleTouchEnd.bind(this),this.gameField=document.querySelector(".game-field"),this.endGame=document.querySelector(".message-lose"),this.addScore=document.querySelector(".game-score"),this.winGame=document.querySelector(".message-win"),this.arrows=["ArrowLeft","ArrowUp","ArrowRight","ArrowDown"],document.addEventListener("keydown",this.listenerArrows),this.x1=null,this.y1=null,this.gameField.addEventListener("touchstart",this.touchStartListener),this.gameField.addEventListener("touchmove",this.touchEndListener)}}const l=document.querySelector("button");l.addEventListener("click",e=>{let i=document.querySelector(".message-start");t&&t.stop(),i.classList.add("hidden"),t=new s,l.classList.remove("start"),l.classList.add("restart"),l.textContent="Restart"});
//# sourceMappingURL=index.4df6a2d2.js.map
